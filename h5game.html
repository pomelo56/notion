<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<head>
  <title>å®ç®±å¼€å¯å°æ¸¸æˆ</title>
  <style>
    .equipment-cell {
      border: 1px solid black;
      width: 100px;
      height: 100px;
      text-align: center;
      vertical-align: middle;
      cursor: pointer;
    }
    #equipmentModal {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      border: 1px solid black;
      padding: 10px;
      background-color: white;
      z-index: 9999;
    }
    .equipment-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
    }
    .empty-cell {
      background-color: lightgray;
    }
    .occupied-cell {
      background-color: white;
    }
    .equipment-level {
      position: absolute;
      top: 5px;
      right: 5px;
      font-size: 12px;
      font-weight: bold;
    }
  #chestImage {
  width: 100px; /* è®¾ç½®å®½åº¦ */
  height: 100px; /* è®¾ç½®é«˜åº¦ */
  position: absolute; /* è®¾ç½®ä½ç½®æ–¹å¼ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œè°ƒæ•´ */
  top: 10px; /* è®¾ç½®è·ç¦»é¡¶éƒ¨çš„è·ç¦» */
  left: 10px; /* è®¾ç½®è·ç¦»å·¦ä¾§çš„è·ç¦» */
}
#functionIcons {
  position: absolute;
  top: 0; /* è°ƒæ•´å‚ç›´ä½ç½® */
  right: -80px; /* å°†å³ä¾§è·ç¦»è®¾ç½®ä¸º20px */
  transform: translateY(64%); /* å‚ç›´å±…ä¸­ */
}

.function-icon {
  width: 50px; /* å›¾æ ‡å®¹å™¨çš„å®½åº¦ */
  height: 50px; /* å›¾æ ‡å®¹å™¨çš„é«˜åº¦ */
  font-size:9px;
  border:1px dotted;
  text-align:center;
  line-height:50px;
  margin-bottom: 10px; /* è°ƒæ•´å›¾æ ‡ä¹‹é—´çš„å‚ç›´é—´è· */
}

#functionIcons img {
  width: 32px; /* è®¾ç½®å›¾æ ‡çš„å®½åº¦ */
  height: 32px; /* è®¾ç½®å›¾æ ‡çš„é«˜åº¦ */
  margin-bottom: 10px; /* è°ƒæ•´å›¾æ ‡ä¹‹é—´çš„å‚ç›´é—´è· */
}
#mainContent {
  width: 330px;
  margin: 0 auto; /* å±…ä¸­é¡µé¢å†…å®¹ */
  position: relative; /* è®¾ç½®ä¸ºç›¸å¯¹å®šä½ */
}
#warp {
  width: 330px;
  margin: 0 auto; /* å±…ä¸­é¡µé¢å†…å®¹ */
  float:left;
}
  </style>
</head>
<body>
<div id="mainContent">
<div id="warp">
  <h1>å®ç®±å¼€å¯å°æ¸¸æˆ</h1>
  <p>å®ç®±æ•°é‡ï¼š<span id="chestCount">20</span></p>
  <button id="openChestButton" onclick="openChest()">æ‰“å¼€å®ç®±</button>
  <button id="autoOpenButton" onclick="toggleAutoOpen()">è‡ªåŠ¨å¼€ç®±</button>
  <p id="result"></p>
  <h2>è§’è‰²è£…å¤‡</h2>
  <div class="equipment-grid" id="equipmentGrid"></div>
  <p id="totalScore">æˆ˜åŠ›æ€»åˆ†ï¼š0</p>
  <h2>èµ„æº</h2>
  <p>é‡‘å¸ï¼š<span id="gold">0</span>&nbsp;&nbsp;&nbsp;ç»éªŒå€¼ï¼š<span id="experience">0</span>&nbsp;&nbsp;&nbsp;ç­‰çº§ï¼š<span id="level">1</span></p>
    <script>
  // è·å–å¯¹å®ç®±å›¾ç‰‡çš„å¼•ç”¨
var chestImage = document.getElementById("chestImage");

// æ›´æ”¹å®ç®±å›¾ç‰‡çš„srcå±æ€§
chestImage.src = "https://img.zcool.cn/community/0171de5acad7cea8012040293a7ff2.jpg"; // æ›¿æ¢ä¸ºæ–°çš„å›¾ç‰‡è·¯å¾„
  </script>

  <div id="equipmentModal">
    <h3 id="modalTitle">è£…å¤‡è¯¦æƒ…</h3>
    <p><strong>ä½ç½®ï¼š</strong><span id="modalPosition"></span></p>
    <p><strong>åŸºç¡€å±æ€§ï¼š</strong><span id="modalBaseAttribute"></span></p>
    <p><strong>é™„åŠ å±æ€§ï¼š</strong><span id="modalSpecialAttribute"></span></p>
    <p><strong>åˆ†å€¼ï¼š</strong><span id="modalScore"></span></p>
    <p><strong>ç­‰çº§ï¼š</strong><span id="modalLevel"></span></p>
    <button onclick="closeModal()">å…³é—­</button>
  </div>

  <script>
  // åœ¨é¡µé¢åŠ è½½æ—¶è°ƒç”¨updateEquipmentGrid()ä»¥æ˜¾ç¤ºé»˜è®¤çš„3è¡Œ4åˆ—è§’è‰²è£…å¤‡
window.onload = function() {
  updateEquipmentGrid();
};
    var equipmentPositions = ["å¤´ç›”", "æŠ¤ç”²", "æ‰‹å¥—", "é‹å­", "é¡¹é“¾", "æˆ’æŒ‡", "æ­¦å™¨", "æ³•å®", "é­”æ–", "ç›¾ç‰Œ", "å¼“ç®­", "æ³•ç¬¦"];
    var baseAttributes = {
      "åŠ›é‡": 10,
      "æ•æ·": 8,
      "æ™ºåŠ›": 5,
      "ä½“åŠ›": 12
    };
    var specialAttributes = ["ç«ç„°ä¼¤å®³", "å†°éœœä¼¤å®³", "é—ªç”µä¼¤å®³", "ç”Ÿå‘½å·å–"];

    var equipmentList = [];
    var totalScore = 0;
    var gold = 0;
    var experience = 0;
    var level = 1;
    var autoOpenInterval = null;
    var autoOpenEnabled = false;
    var chestCount = 20;

    function toggleAutoOpen() {
      autoOpenEnabled = !autoOpenEnabled;
      var autoOpenButton = document.getElementById("autoOpenButton");
      if (autoOpenEnabled) {
        autoOpenButton.textContent = "åœæ­¢è‡ªåŠ¨å¼€ç®±";
        autoOpenInterval = setInterval(openChest, 1000); // è‡ªåŠ¨å¼€ç®±é—´éš” 1 ç§’
      } else {
        autoOpenButton.textContent = "è‡ªåŠ¨å¼€ç®±";
        clearInterval(autoOpenInterval);
      }
    }

    function openChest() {
      if (chestCount === 0) {
        noMoreChests();
        return;
      }

      var randomPositionIndex = Math.floor(Math.random() * equipmentPositions.length);
      var randomPosition = equipmentPositions[randomPositionIndex];

      var randomBaseAttribute = getRandomAttribute();
      var randomSpecialAttribute = getRandomSpecialAttribute();
      var equipmentScore = calculateEquipmentScore(randomBaseAttribute);

      if (experience >= 10) {
        levelUp();
      }

      var existingEquipment = findExistingEquipment(randomPosition);
      if (existingEquipment) {
        var replacePrompt = "æ­¤ä½ç½®å·²è£…å¤‡ï¼š" + existingEquipment["ä½ç½®"] + "ï¼Œåˆ†å€¼ï¼š" + existingEquipment["åˆ†å€¼"] +
          "ï¼Œæ–°è£…å¤‡åˆ†å€¼ï¼š" + equipmentScore;
        if (equipmentScore > existingEquipment["åˆ†å€¼"]) {
          replacePrompt += " â†‘";
        } else if (equipmentScore < existingEquipment["åˆ†å€¼"]) {
          replacePrompt += " â†“";
        }
        replacePrompt += "ï¼Œæ˜¯å¦æ›¿æ¢ï¼Ÿ";

        if (confirm(replacePrompt)) {
          totalScore -= existingEquipment["åˆ†å€¼"];
          equipmentList.splice(equipmentList.indexOf(existingEquipment), 1);
          updateUI();
        } else {
          sellEquipment(existingEquipment);
          return;
        }
      }

      var equipment = {
        "ä½ç½®": randomPosition,
        "åŸºç¡€å±æ€§": randomBaseAttribute,
        "é™„åŠ å±æ€§": randomSpecialAttribute,
        "åˆ†å€¼": equipmentScore,
        "ç­‰çº§": 1 // åˆå§‹ç­‰çº§ä¸º1
      };

      equipmentList.push(equipment);
      totalScore += equipmentScore;

      chestCount--;

      updateUI();

      var resultText = "ä½ è·å¾—äº†ï¼š" + equipment["ä½ç½®"] + "ï¼Œ" + equipment["åŸºç¡€å±æ€§"] + "ï¼Œ" + equipment["é™„åŠ å±æ€§"] + "ï¼Œåˆ†å€¼ï¼š" + equipment["åˆ†å€¼"];
      document.getElementById("result").textContent = resultText;

      if (chestCount === 0) {
        noMoreChests();
      }
    }

    function levelUpEquipment(equipment) {
      if (equipment["ç­‰çº§"]) {
        equipment["ç­‰çº§"]++;
      } else {
        equipment["ç­‰çº§"] = 1;
      }
    }

    function getRandomAttribute() {
      var attributes = Object.keys(baseAttributes);
      var randomAttributeIndex = Math.floor(Math.random() * attributes.length);
      var randomAttribute = attributes[randomAttributeIndex];
      var value = baseAttributes[randomAttribute];
      return randomAttribute + " +" + value;
    }

    function getRandomSpecialAttribute() {
      var randomAttributeIndex = Math.floor(Math.random() * specialAttributes.length);
      return specialAttributes[randomAttributeIndex];
    }

    function calculateEquipmentScore(baseAttribute) {
      var attributeValue = parseInt(baseAttribute.split(" +")[1]);
      return attributeValue * level; // åŸºç¡€å±æ€§åˆ†å€¼åŠ æƒ
    }

    function findExistingEquipment(position) {
      return equipmentList.find(function(equipment) {
        return equipment["ä½ç½®"] === position;
      });
    }

    function sellEquipment(equipment) {
      var randomGold = Math.floor(Math.random() * 5) + 1;
      var randomExperience = Math.floor(Math.random() * 10) + 1;

      gold += randomGold;
      experience += randomExperience;

      updateUI();

      var sellResult = "ä½ å‡ºå”®äº†è£…å¤‡ï¼š" + equipment["ä½ç½®"] + "ï¼Œè·å¾—é‡‘å¸ï¼š" + randomGold + "ï¼Œè·å¾—ç»éªŒå€¼ï¼š" + randomExperience;
      document.getElementById("result").textContent = sellResult;
    }

    function levelUp() {
      level++;
      experience -= 10;

      var levelUpMessage = "æ­å–œï¼ä½ å‡çº§äº†ï¼Œå½“å‰ç­‰çº§ï¼š" + level;
      document.getElementById("result").textContent = levelUpMessage;
      // å‡çº§è£…å¤‡ç­‰çº§
      equipmentList.forEach(function(equipment) {
        levelUpEquipment(equipment);
      });

      updateUI();
    }

    function noMoreChests() {
      var noMoreChestsMessage = "æ²¡æœ‰å®ç®±äº†ï¼Œå¿«å»åšä»»åŠ¡é¢†å–å¤§é‡å®ç®±å§~";
      document.getElementById("result").textContent = noMoreChestsMessage;
      clearInterval(autoOpenInterval);
      autoOpenEnabled = false;
      var autoOpenButton = document.getElementById("autoOpenButton");
      autoOpenButton.style.display = "none";
      document.getElementById("openChestButton").style.display = "none";
      setTimeout(function() {
        window.open("https://www.17173.com", "_blank");
      }, 3000); // å»¶è¿Ÿ 3 ç§’è·³è½¬
    }

    function updateUI() {
      var equipmentListElement = document.getElementById("equipmentList");
      var totalScoreElement = document.getElementById("totalScore");
      var goldElement = document.getElementById("gold");
      var experienceElement = document.getElementById("experience");
      var levelElement = document.getElementById("level");
      var chestCountElement = document.getElementById("chestCount");

      totalScoreElement.textContent = "æ€»åˆ†ï¼š" + totalScore;
      goldElement.textContent = gold;
      experienceElement.textContent = experience;
      levelElement.textContent = level;
      chestCountElement.textContent = chestCount;

      updateEquipmentGrid();
    }

    // æ›´æ–° updateEquipmentGrid å‡½æ•°ä»¥ç”Ÿæˆ3è¡Œ4åˆ—çš„è£…å¤‡æ ¼å­
    function updateEquipmentGrid() {
      var equipmentGrid = document.getElementById("equipmentGrid");
      equipmentGrid.innerHTML = "";

      var rows = 3;
      var columns = 4;

      for (var i = 0; i < rows; i++) {
        var row = document.createElement("div");
        row.className = "equipment-row";

        for (var j = 0; j < columns; j++) {
          var cell = document.createElement("div");
          cell.className = "equipment-cell";
          var positionIndex = i * columns + j;
          cell.textContent = equipmentPositions[positionIndex];

          var existingEquipment = findExistingEquipment(equipmentPositions[positionIndex]);
          if (existingEquipment) {
            cell.className += " occupied-cell";
            var equipmentLevel = existingEquipment["ç­‰çº§"];
            if (equipmentLevel) {
              var levelElement = document.createElement("div");
              levelElement.className = "equipment-level";
              levelElement.textContent = equipmentLevel;
              cell.appendChild(levelElement); // å°†ç­‰çº§æ˜¾ç¤ºå…ƒç´ æ·»åŠ åˆ°è£…å¤‡æ ¼å­
            }
          } else {
            cell.className += " empty-cell";
          }

          cell.addEventListener("click", function(position) {
            return function() {
              showEquipmentModal(equipmentPositions[position], existingEquipment);
            };
          }(positionIndex));
          row.appendChild(cell);
        }

        equipmentGrid.appendChild(row);
      }
    }

    function showEquipmentModal(position, existingEquipment) {
      var equipment = findExistingEquipment(position);

      if (equipment) {
        var modalTitle = document.getElementById("modalTitle");
        var modalPosition = document.getElementById("modalPosition");
        var modalBaseAttribute = document.getElementById("modalBaseAttribute");
        var modalSpecialAttribute = document.getElementById("modalSpecialAttribute");
        var modalScore = document.getElementById("modalScore");
        var modalLevel = document.getElementById("modalLevel");

        modalTitle.textContent = "è£…å¤‡è¯¦æƒ…";
        modalPosition.textContent = equipment["ä½ç½®"];
        modalBaseAttribute.textContent = equipment["åŸºç¡€å±æ€§"];
        modalSpecialAttribute.textContent = equipment["é™„åŠ å±æ€§"];
        modalScore.textContent = equipment["åˆ†å€¼"];
        modalLevel.textContent = equipment["ç­‰çº§"];

        var equipmentModal = document.getElementById("equipmentModal");
        equipmentModal.style.display = "block";
      }
    }

    function closeModal() {
      var equipmentModal = document.getElementById("equipmentModal");
      equipmentModal.style.display = "none";
    }
  </script>
</div>
<div id="functionIcons">
  <div class="function-icon">â›°å†’é™©ï¸</div>
  <div class="function-icon">ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦â€ğŸ‘¦å®¶æ—</div>
  <div class="function-icon">ğŸ¤ºç«æŠ€</div>
  <div class="function-icon">ğŸ˜ï¸å®¶å›­</div>
  <div class="function-icon">ğŸ—ç‹©çŒ</div>
  <div class="function-icon">â›ºå‰¯æœ¬</div>
</div>
</div>
</body>
</html>
